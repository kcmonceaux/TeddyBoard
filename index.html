<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Teddy Board</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#5D5CDE">
  <meta name="mobile-web-app-capable" content="yes">
  <style>
    :root { --color-primary: #5D5CDE; }
    .theme-ocean { --color-primary: #0ea5e9; }
    .theme-forest { --color-primary: #10b981; }
    .theme-sunset { --color-primary: #f59e0b; }
    .theme-lavender { --color-primary: #8b5cf6; }
    .theme-coral { --color-primary: #f97316; }
    .theme-teal { --color-primary: #14b8a6; }
    .card-hover { transition: transform 0.2s ease, box-shadow 0.2s ease; }
    .card-hover:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
    .card-hover:active { transform: translateY(0); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
  </style>
</head>
<body class="bg-white dark:bg-gray-900 font-sans min-h-screen" onload="init()">

<script>
// Initialization function
async function init() {
  // Theme Selector
  const themeSel = document.getElementById('themeSelector');
  const savedTheme = localStorage.getItem('teddyTheme') || 'theme-default';
  document.body.classList.add(savedTheme);
  themeSel.value = savedTheme;
  themeSel.onchange = e => {
    document.body.classList.remove('theme-ocean','theme-forest','theme-sunset','theme-lavender','theme-coral','theme-teal');
    if (e.target.value !== 'theme-default') document.body.classList.add(e.target.value);
    localStorage.setItem('teddyTheme', e.target.value);
  };

  // Language Selector
  const langSel = document.getElementById('langSelector');
  const supportedLangs = ['en','es','fr','de','zh','hi'];
  supportedLangs.forEach(code => {
    const opt = document.createElement('option');
    opt.value = code;
    opt.textContent = new Intl.DisplayNames([code],{type:'language'}).of(code);
    langSel.append(opt);
  });
  const savedLang = localStorage.getItem('teddyLang') || 'en';
  langSel.value = savedLang;
  langSel.onchange = e => {
    localStorage.setItem('teddyLang', e.target.value);
  };

  // Voice Selector
  const voiceSel = document.getElementById('voiceSelector');
  let voices = [];
  function loadVoices() {
    voices = speechSynthesis.getVoices();
    voiceSel.innerHTML = '';
    voices.forEach(v => {
      const opt = document.createElement('option');
      opt.value = v.name;
      opt.textContent = `${v.name} (${v.lang})`;
      voiceSel.append(opt);
    });
  }
  speechSynthesis.onvoiceschanged = loadVoices;
  loadVoices();

  function speak(text) {
    const msg = new SpeechSynthesisUtterance(text);
    msg.rate = 0.9;
    speechSynthesis.cancel();
    speechSynthesis.speak(msg);
  }

  // IndexedDB setup
  const db = await new Promise((res, rej) => {
    const rq = indexedDB.open('TeddyBoard',1);
    rq.onupgradeneeded = e => {
      const idb = e.target.result;
      idb.createObjectStore('profiles',{keyPath:'id',autoIncrement:true});
      const items = idb.createObjectStore('items',{keyPath:'id',autoIncrement:true});
      items.createIndex('byProfile','profileId');
    };
    rq.onsuccess = e => res(e.target.result);
    rq.onerror = e => rej(e.target.error);
  });

  showProfiles();
}

// Profile Overlay
function showProfiles() {
  document.getElementById('profileOverlay').classList.remove('hidden');
}

// etc. Continue with rest...
</script>

<!-- Profile Overlay -->
<div id="profileOverlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
  <div class="bg-white dark:bg-gray-800 p-6 rounded-xl w-full max-w-md">
    <h2 class="text-xl font-bold mb-4 text-center">Select Profile</h2>
    <div id="profileList" class="space-y-2 mb-4"></div>
    <button id="newProfileBtn" class="w-full bg-primary text-white p-3 rounded">+ Create Profile</button>
  </div>
</div>
